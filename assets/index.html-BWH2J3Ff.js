import{_ as i,c as a,a as n,o as l}from"./app-CO77B8re.js";const e={};function h(k,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="mysql安装-5-7版本" tabindex="-1"><a class="header-anchor" href="#mysql安装-5-7版本"><span>mysql安装(5.7版本)</span></a></h2><h3 id="demo版本" tabindex="-1"><a class="header-anchor" href="#demo版本"><span>demo版本：</span></a></h3><p>拉取镜像：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pull</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动容器实例：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 运行容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 3306:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">123456</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:5.7</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看正在运行的容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ps</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入指定容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 容器ID</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 连接mysql服务测试是否正常</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -uroot</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>存在问题：</p><p>中文乱码：mysql容器默认的字符编码格式为latin1。</p><p>容器删除，mysql中的数据信息，log日志信息等数据丢失。</p><h3 id="企业级安装" tabindex="-1"><a class="header-anchor" href="#企业级安装"><span>企业级安装：</span></a></h3><p>启动容器指定容器卷的映射：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 3306:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql/log:/var/log/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql/data:/var/lib/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql/conf:/etc/mysql/conf.d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在容器映射到宿主机的配置文件的目录下新建配置文件my.cnf：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">client</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">default-character-set</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">utf8</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysqld</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">collation_server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> utf8_general_ci</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">character_set_server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> utf8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>之后重启docker容器使配置文件生效：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>至此单机版mysql就解决了字符编码问题，并将数据相关目录映射到了宿主机。</p><h3 id="主从复制版" tabindex="-1"><a class="header-anchor" href="#主从复制版"><span>主从复制版：</span></a></h3><p>mysql主服务器安装：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 3307:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-master</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/log:/var/log/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/data:/var/lib/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/conf:/etc/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进入<code>/app/mysql-master/conf</code>，新建<code>my.cnf</code>配置文件:</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysqld</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置server_id, 同一个局域网中需要唯一</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">server_id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">101</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 指定不需要同步的数据库名称</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog-ignore-db</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysql</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 开启二进制日志功能</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">log-bin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mall-mysql-bin</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置二进制日志使用内存大小（事务）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog_cache_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1M</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置使用的二进制日志格式（mixed,statement,row）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog_format</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mixed</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 二进制日志过期清理时间。默认值为0，表示不自动清理</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">expire_logs_days</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">7</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slave_skip_errors</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1062</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数说明：</p><p>log-bin：启用二进制日志（binary logging），并指定生成的二进制日志文件的基本名称，当前配置中<code>mall-mysql-slave1-bin</code> 是指定的前缀名，实际的日志文件名会在此基础上加上顺序编号和扩展名，例如 <code>mall-mysql-slave1-bin.000001</code>、<code>mall-mysql-slave1-bin.000002</code> 等。</p><p>binlog_cache_size：定义了为每个客户端连接分配的二进制日志缓存大小，这个缓存用于存储在事务过程中对数据库所做的更改（针对那些支持事务的存储引擎，如InnoDB），以便这些更改能够被有效地写入到二进制日志中。</p><p>binlog_format：MySQL数据库中用于设置二进制日志记录格式的一个选项。</p><p>STATEMENT：基于语句的日志记录（STATEMENT-based logging）：在这种模式下，MySQL仅记录导致数据变更的SQL语句。这种方式的优点是日志文件相对较小且容易阅读，适用于大多数更新操作。然而，在一些特定的情况下，比如使用了不确定函数（如UUID()）、触发器或存储过程等，仅记录语句可能导致从服务器上的数据与主服务器不一致。</p><p>ROW：这种模式记录的是实际受影响的数据行的变化。尽管这会导致日志文件变大，但它能够更准确地反映所有更改，特别是在上述提到的那些复杂场景中。</p><p>MIXED：mixed 模式允许MySQL自动选择最适合当前操作的日志记录方式，当MySQL判断某个操作使用基于语句的日志记录可能会导致不一致的问题时，它会自动转换为基于行的记录方式。这样既能够享受基于语句日志记录带来的效率优势，又能在必要时保证数据的一致性和准确性。</p><p>重启mysql主服务：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-master</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>新建用于主从同步的用户：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入mysql-master容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 使用root用户登录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -uroot</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建数据同步用户</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> identified</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> by</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">123456</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 授权</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">grant</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replication</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slave,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replication</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> client</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 刷新权限</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">flush</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> privileges</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>mysql从库安装：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 3308:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-slave</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/log:/var/log/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/data:/var/lib/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/conf:/etc/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=root</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:5.7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在/app/mysql-slave/conf下新增配置文件my.cnf并增加如下配置信息：</p><div class="language-mysql line-numbers-mode" data-ext="mysql" data-title="mysql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[mysqld]</span></span>
<span class="line"><span>## 设置server_id, 同一个局域网内需要唯一</span></span>
<span class="line"><span>server_id=102</span></span>
<span class="line"><span>## 指定不需要同步的数据库名称</span></span>
<span class="line"><span>binlog-ignore-db=mysql</span></span>
<span class="line"><span>## 开启二进制日志功能，以备slave作为其它数据库实例的Master时使用</span></span>
<span class="line"><span>log-bin=mall-mysql-slave1-bin</span></span>
<span class="line"><span>## 设置二进制日志使用内存大小（事务）</span></span>
<span class="line"><span>binlog_cache_size=1M</span></span>
<span class="line"><span>## 设置使用的二进制日志格式（mixed,statement,row）</span></span>
<span class="line"><span>binlog_format=mixed</span></span>
<span class="line"><span>## 二进制日志过期清理时间。默认值为0，表示不自动清理</span></span>
<span class="line"><span>expire_logs_days=7</span></span>
<span class="line"><span>## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断</span></span>
<span class="line"><span>## 如：1062错误是指一些主键重复，1032是因为主从数据库数据不一致</span></span>
<span class="line"><span>slave_skip_errors=1062</span></span>
<span class="line"><span>## relay_log配置中继日志</span></span>
<span class="line"><span>relay_log=mall-mysql-relay-bin</span></span>
<span class="line"><span>## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span>
<span class="line"><span>log_slave_updates=1</span></span>
<span class="line"><span>## slave设置只读（具有super权限的用户除外）</span></span>
<span class="line"><span>read_only=1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数说明：</p><p>relay_log：配置MySQL从服务器（Slave）上的中继日志文件名称的设置，在MySQL主从复制架构中，主服务器上的数据变更会记录到二进制日志中，然后从服务器通过I/O线程连接到主服务器，并将主服务器的二进制日志读取过来存储在自己的中继日志文件中。之后，从服务器上的SQL线程会读取这些中继日志文件并将变更应用到本地数据库中。</p><p>log_slave_updates：MySQL复制配置中的一个参数，当这个参数被设置在从服务器上时，它指示从服务器记录通过复制从主服务器接收到并执行的更新操作到自己的二进制日志中。默认情况下，这个选项是关闭的（即值为0），这意味着从服务器不会记录这些从主服务器同步过来的更新。log_slave_updates=1 使得从服务器不仅能够接收来自主服务器的数据变更并应用这些变更，还能将同样的变更记录到自身的二进制日志中，从而扩展了MySQL复制架构的功能性和灵活性。不过需要注意的是，开启此选项可能会增加从服务器的磁盘I/O负载以及存储需求，因为需要额外的空间来保存二进制日志文件。因此，在启用之前应评估其对系统资源的影响。</p><p>重启从库：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-slave</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在主数据库中查看主从同步状态：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入主库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -uroot</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看主从同步状态</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主要查看返回结果的文件名<code>File</code>、当前位置<code>Position</code> 信息。</p><p>进入从库配置主从同步信息：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入从库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-slave</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -uroot</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 格式：</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># change master to master_host=&#39;宿主机ip&#39;,master_user=&#39;主数据库配置的主从复制用户名&#39;,master_password=&#39;主数据库配置的主从复制用户密码&#39;,master_port=宿主机主数据库端口,master_log_file=&#39;主数据库主从同步状态的文件名File&#39;,master_log_pos=主数据库主从同步状态的Position,master_connect_retry=连接失败重试时间间隔（秒）;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">change</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master_host=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.xxx.xxx</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_user=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_password=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">123456</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_port=3307,master_log_file=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mall-mysql-bin.000001</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_log_pos=769,master_connect_retry=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">30</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看主从同步状态：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># \\G 可以将横向的结果集表格转换成纵向展示。</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># slave status的字段比较多，纵向展示比友好</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slave</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\G</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了展示刚刚配置的主数据库信息外，主要关注 <code>Slave_IO_Running</code>、<code>Slave_SQL_Running</code>。目前两个值应该都为 <code>No</code>，表示还没有开始。</p><p>在从库中开启主从同步：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slave</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>再次查看主从同步状态，<code>Slave_IO_Running</code>、<code>Slave_SQL_Running</code>都变为<code>Yes</code>。</p><p>测试主从同步效果：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在主库中新建库、新建表并插入数据</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> database</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db01</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">use</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db01</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> table</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> t1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (id </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">int,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> varchar</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">20</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">insert</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> into</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> t1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> values</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (1, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">abc</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在从数据库上使用库、查看数据同步情况：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> databases</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">use</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> db01</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">elect</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> from</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> t1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mysql安装-8-0版本" tabindex="-1"><a class="header-anchor" href="#mysql安装-8-0版本"><span>mysql安装(8.0版本)：</span></a></h2><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 拉取镜像</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pull</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:8.0.25</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建主节点容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 16036:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-master</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/log:/var/logs/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/data:/var/lib/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/conf:/etc/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/mysql-files:/var/lib/mysql-files</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=yangyongjun</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:8.0.25</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改配置文件：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-master/conf</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 编辑如下内容</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">client</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">default-character-set</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">utf8</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysqld</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">collation_server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> utf8_general_ci</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">character_set_server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> utf8</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置server_id, 同一个局域网中需要唯一</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">server_id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">101</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 指定不需要同步的数据库名称</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog-ignore-db</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysql</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 开启二进制日志功能</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">log-bin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mall-mysql-bin</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置二进制日志使用内存大小（事务）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog_cache_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1M</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置使用的二进制日志格式（mixed,statement,row）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog_format</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mixed</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 二进制日志过期清理时间。默认值为0，表示不自动清理</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">expire_logs_days</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">7</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slave_skip_errors</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1062</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启容器：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-master</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看主从同步的主库状态</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># mall-mysql-bin.000003	156		mysql	</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新建主库用户用户同步主库数据到从库：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建数据同步用户</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> identified</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> by</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">www.yyj.com</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 授权</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">grant</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replication</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slave,</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replication</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> client</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 刷新权限</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">flush</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> privileges</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动从库容器：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 16037:3306</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-slave</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/log:/var/logs/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/data:/var/lib/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/conf:/etc/mysql</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/mysql-files:/var/lib/mysql-files</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MYSQL_ROOT_PASSWORD=www.yyj.com</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql:8.0.25</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>修改从库配置文件：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 新增配置文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/mysql-slave/conf/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 编辑如下内容</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">client</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">default-character-set</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">utf8</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysqld</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">collation_server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> utf8_general_ci</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">character_set_server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> utf8</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置server_id, 同一个局域网内需要唯一</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">server_id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">102</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 指定不需要同步的数据库名称</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog-ignore-db</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysql</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 开启二进制日志功能，以备slave作为其它数据库实例的Master时使用</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">log-bin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mall-mysql-slave1-bin</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置二进制日志使用内存大小（事务）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog_cache_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1M</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 设置使用的二进制日志格式（mixed,statement,row）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">binlog_format</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mixed</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 二进制日志过期清理时间。默认值为0，表示不自动清理</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">expire_logs_days</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">7</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 如：1062错误是指一些主键重复，1032是因为主从数据库数据不一致</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slave_skip_errors</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1062</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## relay_log配置中继日志</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">relay_log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mall-mysql-relay-bin</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">log_slave_updates</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## slave设置只读（具有super权限的用户除外）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">read_only</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>主从数据同步开启：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mysql-slave</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 由于mysql默认使用的默认密码插件为Authentication plugin &#39;caching_sha2_password&#39;需要先申请公钥</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 允许 RSA 公钥检索</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">CHANGE</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MASTER</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TO</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> GET_MASTER_PUBLIC_KEY</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 开启主从同步其中master_log_file和master_log_pos参数根据主数据库状态查看修改</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">change</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master_host=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.211.132</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_user=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slave</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_password=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">www.yyj.com</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_port=16036,master_log_file=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mall-mysql-bin.000003</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">,master_log_pos=156,master_connect_retry=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">30</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 开始同步</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slave</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看主从同步状态并验证：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slave</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="redis安装" tabindex="-1"><a class="header-anchor" href="#redis安装"><span>redis安装</span></a></h2><h3 id="demo版本-1" tabindex="-1"><a class="header-anchor" href="#demo版本-1"><span>demo版本：</span></a></h3><p>拉取redis镜像：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pull</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>运行容器：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 6379:6379</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>问题：没有挂载数据卷，配置文件修改和数据随容器删除也被删除。</p><h3 id="企业版本" tabindex="-1"><a class="header-anchor" href="#企业版本"><span>企业版本：</span></a></h3><p>新建redis配置文件：</p><p>在/app/redis下新增redis.conf配置文件，并修改一下配置信息：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 开启密码验证</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">requirepass</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 123</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 允许redis远程连接，需要注释掉绑定的IP</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># bind 127.0.0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 关闭保护模式（可选）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">protected-mode</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> no</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 注释掉daemonize yes，或者配置成 daemonize no。因为该配置和 docker run中的 -d 参数冲突，会导致容器一直启动失败</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">daemonize</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> no</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 开启redis数据持久化， （可选）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动并入并挂载配置文件和数据文件的容器卷：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 6379:6379</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis/redis.conf:/etc/redis/redis.conf</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">           -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis/data:/data</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">           redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">           redis-server</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/redis/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="集群版本" tabindex="-1"><a class="header-anchor" href="#集群版本"><span>集群版本：</span></a></h3><p>启动集群中三注三从的节点：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># --net host 使用宿主机的IP和端口，默认</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># --cluster-enabled yes 开启redis集群</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># --appendonly yes 开启redis持久化</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># --port 6381 配置redis端口号</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第1台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-1</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-1:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6381</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第2台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-2</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-2:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6382</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第3台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-3</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-3:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6383</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第4台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-4</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-4:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6384</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第5台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-5</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-5:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6385</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第6台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-6</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-6:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6386</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>构建集群的主从关系：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 任意进入其中某节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 构建主从关系</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6382</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6383</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6384</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6385</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6386</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-replicas</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># redis尝试自动进行主从节点分配，redis自动分配结果完成后，需要输入 Yes 确认配置信息： </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f451eb48bbc0a7c31c7da022ffe80cc1696e0f37</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[0-5460]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5461 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 05984211b8c38222a73abeff1d4e459c0fe1efbc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6382</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[5461-10922]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5462 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1fc935c12b1d34a7df50aed643c195eb29bb3435</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6383</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[10923-16383]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5461 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f8d0de47114bf33438747acd713cce4e412ae721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6384</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1fc935c12b1d34a7df50aed643c195eb29bb3435</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> de0b393c17e452d856f6de2b348e9ca4e5aa4002</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6385</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f451eb48bbc0a7c31c7da022ffe80cc1696e0f37</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 0c0767e13a09ee48541738d4163592cd9842c143</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6386</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 05984211b8c38222a73abeff1d4e459c0fe1efbc</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Can</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> I</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> above</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configuration?</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (type </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">yes</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> accept</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">):</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输入<code>Yes</code>确认后，redis会向其他节点发送信息加入集群，并分配哈希槽：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Nodes</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configuration</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> updated</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Assign</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> a</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> different</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> epoch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> each</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> node</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Sending</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> CLUSTER</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MEET</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> messages</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> join</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cluster</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Waiting</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> for</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> join</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">.....</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Performing</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Check</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (using </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">node</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f451eb48bbc0a7c31c7da022ffe80cc1696e0f37</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[0-5460]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5461 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> additional</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replica</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1fc935c12b1d34a7df50aed643c195eb29bb3435</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6383</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[10923-16383]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5461 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> additional</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replica</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 05984211b8c38222a73abeff1d4e459c0fe1efbc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6382</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[5461-10922]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5462 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> additional</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replica</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 0c0767e13a09ee48541738d4163592cd9842c143</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6386</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (0 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) slave</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 05984211b8c38222a73abeff1d4e459c0fe1efbc</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f8d0de47114bf33438747acd713cce4e412ae721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6384</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (0 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) slave</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1fc935c12b1d34a7df50aed643c195eb29bb3435</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> de0b393c17e452d856f6de2b348e9ca4e5aa4002</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6385</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (0 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) slave</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f451eb48bbc0a7c31c7da022ffe80cc1696e0f37</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> All nodes agree about slots configuration.</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> for</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> open</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slots...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slots</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> coverage...</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> All 16384 slots covered.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看集群状态：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入任意节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6381</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看集群信息</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 分配的哈希槽数量 cluster_slots_assigned为16384，集群节点数量cluster_known_nodes为6 </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> info</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看集群的节点信息</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nodes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>集群读写说明：</p><p>报错：<code>k1</code>经过计算得到的哈希槽为12706，但是当前连接的redis-server为<code>6381</code>（即节点1），它的哈希槽为：<code>[0,5460]</code>（在创建构建主从关系时redis有提示，也可以通过 <code>cluster nodes</code>查看），所以会因为存不进去而报错。</p><p>报错：<code>k1</code>经过计算得到的哈希槽为12706，但是当前连接的redis-server为<code>6381</code>（即节点1），它的哈希槽为：<code>[0,5460]</code>（在创建构建主从关系时redis有提示，也可以通过 <code>cluster nodes</code>查看），所以会因为存不进去而报错。 执行 <code>set k2 v2</code>可以成功，因为<code>k2</code>计算出的哈希槽在<code>[0-5460]</code>区间中。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入任意节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 客户端连接不加-c参数时</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6381</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加键值对可能成功也可能失败</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> k1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 连接时使用-c，表示集群模式</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6381</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>集群信息检查：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入任意节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查集群信息</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 输入任意一台主节点地址都可以进行集群检查</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 返回信息</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 当前集群中各个节点存储的key的数量</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">192.168.xxx.xxx:6381</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (f451eb48...) -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 0 keys </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 5461</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slots</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slaves.</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">192.168.xxx.xxx:6383</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (1fc935c1...) -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 1 keys </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 5461</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slots</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slaves.</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">192.168.xxx.xxx:6382</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (05984211...) -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 0 keys </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 5462</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slots</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slaves.</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 1 keys in 3 masters.  </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">0.00</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> keys</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> per</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slot</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> average.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 主从机器信息</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Performing</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Check</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (using </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">node</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f451eb48bbc0a7c31c7da022ffe80cc1696e0f37</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[0-5460]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5461 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> additional</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replica</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1fc935c12b1d34a7df50aed643c195eb29bb3435</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6383</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[10923-16383]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5461 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> additional</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replica</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">M:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 05984211b8c38222a73abeff1d4e459c0fe1efbc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6382</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:[5461-10922]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (5462 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) master</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> additional</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> replica</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 0c0767e13a09ee48541738d4163592cd9842c143</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6386</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (0 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) slave</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 05984211b8c38222a73abeff1d4e459c0fe1efbc</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f8d0de47114bf33438747acd713cce4e412ae721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6384</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (0 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) slave</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1fc935c12b1d34a7df50aed643c195eb29bb3435</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">S:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> de0b393c17e452d856f6de2b348e9ca4e5aa4002</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6385</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   slots:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (0 </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">slots</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) slave</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   replicates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> f451eb48bbc0a7c31c7da022ffe80cc1696e0f37</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> All nodes agree about slots configuration.</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> for</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> open</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slots...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;&gt;&gt; </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> slots</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> coverage...</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> All 16384 slots covered.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>集群模式下扩容：</p><p>因为业务量激增，需要向当前3主3从的集群中再加入1主1从两个节点。</p><p>启动带加入集群的redis节点：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第7台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-7</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-7:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6387</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 启动第8台节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --net</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> host</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --privileged=true</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /app/redis-cluster/share/redis-node-8:/data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis:6.0.8</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --appendonly</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6388</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加入到集群中：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入任意一台待加入的节点</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -it</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> redis-node-7</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 将6387作为master加入集群 </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 格式：redis-cli --cluster add-node 本节点地址 要加入的集群中的其中一个节点地址</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add-node</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6387</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看集群状态</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 发现6371节点已经作为master加入了集群，但是该节点没有被分配槽位。 </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 重新分配集群的槽位 </span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reshard</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>redis经过槽位检查后，会提示需要输入待分配的槽位数量：</p><p>例如，我们现在是4台master，我们想要给node7分配4096个槽位，这样每个节点都是4096个槽位。 输入<code>4096</code>后，会让输入要接收这些哈希槽的节点ID，填入node7的节点ID即可。（就是节点信息中很长的一串十六进制串）。</p><p>然后会提示，询问要从哪些节点中分配出4096个槽分给Node7。一般选择 <code>all</code>，即将之前的3个主节点的槽位都均一些给Node7，这样可以使得每个节点的槽位数相等均衡。输入<code>all</code>之后，redis会列出一个计划，内容是自动从前面的3台master中拨出一部分槽位分给Node7的槽位，需要确认一下分配的计划。</p><p>输入<code>all</code>之后，redis会列出一个计划，内容是自动从前面的3台master中拨出一部分槽位分给Node7的槽位，需要确认一下分配的计划，输入<code>yes</code>确认后，redis便会自动重新reshard，给Node7分配槽位。</p><p>检查集群信息：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>可以看到集群中已分配出4096个槽位给到node7。</p><p>为新加入的节点node7添加从节点：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># redis便会向6388发送消息，使其加入集群并成为6387的从节点。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add-node</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6388</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-slave</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster-master-id</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> node7节点的十六进制编号字符串</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查集群的主从状态是否正常</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-cli</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cluster</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.xxx.xxx:6381</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>集群模式下的缩容：</strong></p>`,117)]))}const p=i(e,[["render",h],["__file","index.html.vue"]]),d=JSON.parse(`{"path":"/devops/common/soft/","title":"docker安装常用软件","lang":"zh-CN","frontmatter":{"title":"docker安装常用软件","createTime":"2025/03/16 20:19:08","permalink":"/devops/common/soft/","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;if (um === 'dark' || (um !== 'light' && sm)) {document.documentElement.classList.add('dark');}})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":2,"title":"mysql安装(5.7版本)","slug":"mysql安装-5-7版本","link":"#mysql安装-5-7版本","children":[{"level":3,"title":"demo版本：","slug":"demo版本","link":"#demo版本","children":[]},{"level":3,"title":"企业级安装：","slug":"企业级安装","link":"#企业级安装","children":[]},{"level":3,"title":"主从复制版：","slug":"主从复制版","link":"#主从复制版","children":[]}]},{"level":2,"title":"mysql安装(8.0版本)：","slug":"mysql安装-8-0版本","link":"#mysql安装-8-0版本","children":[]},{"level":2,"title":"redis安装","slug":"redis安装","link":"#redis安装","children":[{"level":3,"title":"demo版本：","slug":"demo版本-1","link":"#demo版本-1","children":[]},{"level":3,"title":"企业版本：","slug":"企业版本","link":"#企业版本","children":[]},{"level":3,"title":"集群版本：","slug":"集群版本","link":"#集群版本","children":[]}]}],"readingTime":{"minutes":15.99,"words":4796},"git":{"createdTime":1742137905000,"updatedTime":1751110252000,"contributors":[{"name":"yongjun","email":"1640808365@qq.com","commits":3}]},"filePathRelative":"notes/devops/docker/docker安装常用软件.md"}`);export{p as comp,d as data};
